# Project Context

## Purpose

FreeIPCC æ˜¯ä¸€ä¸ªå¼€æºçš„å¤§æ¨¡å‹å‘¼å«ä¸­å¿ƒç³»ç»Ÿï¼ˆLLM Call Center / AI Call Centerï¼‰ï¼Œè‡´åŠ›äºæˆä¸ºå®¢æˆ·æœåŠ¡é¢†åŸŸçš„å…¨çƒé¢†å¯¼è€…ã€‚

### æ ¸å¿ƒç›®æ ‡
- æ‰“é€ å¼€æ”¾ã€çµæ´»ä¸”å¼ºå¤§çš„å¼€æºå‘¼å«ä¸­å¿ƒè§£å†³æ–¹æ¡ˆ
- è§£å†³ä¼ ç»Ÿ "ASR+NLP+TTS" æ—¶ä»£çš„ç—›ç‚¹ï¼Œè®© AI çœŸæ­£å¯ç”¨
- èµ‹èƒ½ä¼ä¸šå’Œç»„ç»‡æ„å»ºå¹¶è¿è¥è‡ªå·±çš„å®¢æˆ·æœåŠ¡ä½“ç³»
- å°†å¤§æ¨¡å‹å‘¼å«ä¸­å¿ƒèƒ½åŠ›èµ‹èƒ½é›†æˆå•†ï¼ŒæœåŠ¡å¤§é‡å®¢æˆ·

### ä¸»è¦åŠŸèƒ½æ¨¡å—
- **è¯åŠ¡ç³»ç»Ÿ**ï¼šå‘¼å…¥/å‘¼å‡ºã€IVRã€æ™ºèƒ½è·¯ç”±
- **å·¥å•ç³»ç»Ÿ**ï¼šå·¥å•ç®¡ç†ã€æµç¨‹è‡ªåŠ¨åŒ–
- **IM åœ¨çº¿å®¢æœç³»ç»Ÿ**ï¼šå¤šæ¸ é“æ¥å…¥ï¼ˆç”µè¯ã€çŸ­ä¿¡ã€ç¤¾äº¤åª’ä½“ã€ç½‘é¡µèŠå¤©ç­‰ï¼‰
- **å½•éŸ³ç³»ç»Ÿ**ï¼šé€šè¯å½•éŸ³ä¸å›æ”¾
- **AI æœºå™¨äºº**ï¼šå¤§æ¨¡å‹å‘¼å…¥/å‘¼å‡ºæœºå™¨äººã€æ™ºèƒ½å®¢æœ

## Tech Stack

### åç«¯æŠ€æœ¯
- **ä¸»è¦è¯­è¨€**ï¼šJavaã€Python
- **æ¡†æ¶**ï¼šStrutsï¼ˆOnlineChat æ¨¡å—ï¼‰
- **ç¼“å­˜**ï¼šMemcached

### å‰ç«¯æŠ€æœ¯ï¼ˆworkorder_uiï¼‰
- **æ¡†æ¶**ï¼šReact 18ã€Ant Design Pro v6
- **UI ç»„ä»¶åº“**ï¼šAnt Design 4.xã€@ant-design/pro-componentsã€Material UI 5.x
- **æ„å»ºå·¥å…·**ï¼šUmiJS Max
- **è¯­è¨€**ï¼šTypeScript
- **çŠ¶æ€ç®¡ç†**ï¼šReduxã€DVA
- **å›¾è¡¨å¯è§†åŒ–**ï¼š@ant-design/chartsã€BizChartsã€ReactFlow
- **AI/èŠå¤©ç»„ä»¶**ï¼š@chatui/coreã€Flowise Embedã€LangChain
- **å®æ—¶é€šä¿¡**ï¼šSocket.io Client
- **Markdown æ¸²æŸ“**ï¼šreact-markdownã€remark-gfmã€rehype-raw

### æµ‹è¯•å·¥å…·
- **å•å…ƒæµ‹è¯•**ï¼šJest
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šPlaywright
- **ä»£ç æ£€æŸ¥**ï¼šESLintã€Prettier

### è¿è¡Œç¯å¢ƒ
- Node.js >= 12.0.0
- å¼€å‘å®¹å™¨ï¼šUbuntu 24.04.3 LTS

## Project Conventions

### Code Style
- ä½¿ç”¨ ESLint + Prettier è¿›è¡Œä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥
- TypeScript ä¸¥æ ¼æ¨¡å¼ï¼ˆ`strict: true`ï¼‰
- è·¯å¾„åˆ«åï¼š`@/*` æ˜ å°„åˆ° `./src/*`
- æ–‡ä»¶å‘½åï¼šç»„ä»¶ä½¿ç”¨ PascalCaseï¼Œå·¥å…·å‡½æ•°ä½¿ç”¨ camelCase
- ä»£ç æäº¤å‰è‡ªåŠ¨è¿è¡Œ lint-staged æ£€æŸ¥

### Architecture Patterns
- **å‰ç«¯æ¶æ„**ï¼šåŸºäº Ant Design Pro çš„ä¼ä¸šçº§ä¸­åå°å‰ç«¯è§£å†³æ–¹æ¡ˆ
- **é¡µé¢è·¯ç”±**ï¼šçº¦å®šå¼è·¯ç”±ï¼ˆpages ç›®å½•ç»“æ„å³è·¯ç”±ï¼‰
- **ç»„ä»¶ç»“æ„**ï¼š
  - `src/pages/` - é¡µé¢ç»„ä»¶
  - `src/components/` - é€šç”¨ç»„ä»¶
  - `src/services/` - API æœåŠ¡å±‚
  - `src/utils/` - å·¥å…·å‡½æ•°
  - `src/hooks/` - è‡ªå®šä¹‰ Hooks
  - `src/store/` - Redux Store
  - `src/ui-component/` - UI åŸºç¡€ç»„ä»¶
- **API ç®¡ç†**ï¼šä½¿ç”¨ OpenAPI/Swagger ç”Ÿæˆç±»å‹å®šä¹‰
- **å›½é™…åŒ–**ï¼šæ”¯æŒå¤šè¯­è¨€ï¼ˆlocales ç›®å½•ï¼‰

### Testing Strategy
- **å•å…ƒæµ‹è¯•**ï¼šJestï¼Œæµ‹è¯• URL ä¸º `http://localhost:8000`
- **ç»„ä»¶æµ‹è¯•**ï¼š`npm run test:component` è¿è¡Œç»„ä»¶æµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šPlaywrightï¼Œæ”¯æŒ Chromium å’Œ Firefox
- CI ç¯å¢ƒä¸­å¤±è´¥è‡ªåŠ¨é‡è¯• 2 æ¬¡

### Git Workflow
- ä¸»åˆ†æ”¯ï¼š`main`
- ä½¿ç”¨ Husky è¿›è¡Œ Git Hooks ç®¡ç†
- æäº¤å‰è‡ªåŠ¨æ‰§è¡Œ lint-staged æ£€æŸ¥
- å»ºè®®ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯

## Domain Context

### å‘¼å«ä¸­å¿ƒé¢†åŸŸæœ¯è¯­
- **IVR (Interactive Voice Response)**ï¼šäº¤äº’å¼è¯­éŸ³åº”ç­”ç³»ç»Ÿ
- **ACD (Automatic Call Distribution)**ï¼šè‡ªåŠ¨å‘¼å«åˆ†é…
- **CTI (Computer Telephony Integration)**ï¼šè®¡ç®—æœºç”µè¯é›†æˆ
- **åå¸­ (Agent)**ï¼šå®¢æœäººå‘˜å·¥ä½œä½
- **å·¥å• (Ticket/Work Order)**ï¼šå®¢æˆ·æœåŠ¡è¯·æ±‚è®°å½•
- **ASR (Automatic Speech Recognition)**ï¼šè‡ªåŠ¨è¯­éŸ³è¯†åˆ«
- **TTS (Text-to-Speech)**ï¼šæ–‡å­—è½¬è¯­éŸ³
- **NLP (Natural Language Processing)**ï¼šè‡ªç„¶è¯­è¨€å¤„ç†

### æ¨¡å—è¯´æ˜
- **cc/**ï¼šå‘¼å«ä¸­å¿ƒæ ¸å¿ƒåŠŸèƒ½ï¼ˆå…¬å¸ç®¡ç†ã€åˆ†ç»„ã€è·¯ç”±ã€ç½‘å…³ã€å½•éŸ³å›æ”¾ï¼‰
- **AiChat/**ï¼šAI èŠå¤©åŠŸèƒ½ï¼ˆç”¨æˆ·ç«¯å’Œåå¸­ç«¯ï¼‰
- **flow/**ï¼šæµç¨‹è®¾è®¡å™¨
- **robot/**ï¼šæœºå™¨äººé…ç½®
- **monitor/**ï¼šç›‘æ§æ¨¡å—
- **report/**ï¼šæŠ¥è¡¨æ¨¡å—
- **system/**ï¼šç³»ç»Ÿç®¡ç†

## Important Constraints

### æŠ€æœ¯çº¦æŸ
- éœ€æ”¯æŒä¿¡åˆ›ç¯å¢ƒï¼ˆå›½äº§åŒ–æ›¿ä»£ï¼‰
- å¯å¯¹æ¥æ€ç§‘ã€Avaya ç­‰ä¼ ç»Ÿå‘¼å«ä¸­å¿ƒç³»ç»Ÿï¼ˆåˆ©æ—§ï¼‰
- æ”¯æŒå¯¹æ¥å¸‚é¢ä¸»æµå¤§æ¨¡å‹åŠç§æœ‰æ¨¡å‹

### ä¸šåŠ¡çº¦æŸ
- æºä»£ç ä»˜è´¹åå¯è‡ªç”¨ã€å¯å•†ç”¨
- æ¶‰åŠå¼€æºæ¨¡å—éœ€éµå®ˆå„æ¨¡å—è‡ªèº«çš„åè®®è¦æ±‚

### å®¢æˆ·æ¡ˆä¾‹å‚è€ƒ
- ç”µä¿¡è¿è¥å•†ï¼šç”µä¿¡ã€è”é€šã€åæ•°ï¼ˆå¹¿ç”µï¼‰
- ä¸‰ç”²åŒ»é™¢ã€é«˜æ ¡ã€æ”¿åºœå…¬å…±éƒ¨é—¨

## External Dependencies

### å¤§æ¨¡å‹/AI æœåŠ¡
- æ”¯æŒå¯¹æ¥å¤šç§å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰
- LangChain é›†æˆ
- Flowise æµç¨‹ç¼–æ’

### é€šä¿¡æœåŠ¡
- FreeSWITCH ç”Ÿæ€
- Socket.io å®æ—¶é€šä¿¡

### ç¬¬ä¸‰æ–¹é›†æˆ
- CRM ç³»ç»Ÿé›†æˆèƒ½åŠ›
- OpenAPI/Swagger API è§„èŒƒ

### äº‘åŸç”Ÿæ”¯æŒ
- Docker å®¹å™¨åŒ–éƒ¨ç½²
- æ”¯æŒå¼¹æ€§æ‰©å±•ä¸è‡ªåŠ¨è¿ç»´
---

## System Status (ç³»ç»Ÿå½“å‰çŠ¶æ€)

> æœ€åæ›´æ–°: 2025-12-15

### ä»£ç åº“ç»Ÿè®¡

| æ¨¡å— | æ–‡ä»¶ç±»å‹ | æ–‡ä»¶æ•°é‡ | çŠ¶æ€ |
|------|---------|---------|------|
| workorder_ui (å‰ç«¯) | TypeScript/TSX | 474 | âœ… æ´»è·ƒå¼€å‘ |
| OnlineChat_Sample (åœ¨çº¿å®¢æœ) | Java | 160 | âœ… ç¤ºä¾‹ä»£ç  |
| console (å‰ç«¯æ„å»ºäº§ç‰©) | JS/CSS | 80+ | âœ… å·²æ„å»º |

### æ¨¡å—è¯¦ç»†åˆ†æ

#### 1. workorder_ui - å‰ç«¯ç®¡ç†ç³»ç»Ÿ

**æŠ€æœ¯æ¶æ„**ï¼š
- åŸºäº Ant Design Pro v6 + UmiJS Max çš„ä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿ
- React 18 + TypeScript ä¸¥æ ¼æ¨¡å¼
- åŒçŠ¶æ€ç®¡ç†ï¼šRedux + DVA (ç”¨äºä¸åŒåœºæ™¯)
- åŒ UI åº“ï¼šAnt Design (ä¸») + Material UI (GPT Chat æ¨¡å—)

**åŠŸèƒ½æ¨¡å—åˆ†å¸ƒ**ï¼š

| é¡µé¢ç›®å½• | åŠŸèƒ½æè¿° | å®Œæˆåº¦ |
|---------|---------|--------|
| `/pages/cc/` | å‘¼å«ä¸­å¿ƒæ ¸å¿ƒ | â­â­â­â­ |
| â”œâ”€â”€ company/ | å…¬å¸/ç§Ÿæˆ·ç®¡ç† | âœ… å®Œæˆ |
| â”œâ”€â”€ group/ | åå¸­åˆ†ç»„ç®¡ç† | âœ… å®Œæˆ |
| â”œâ”€â”€ route/ | è·¯ç”±é…ç½® (ç½‘å…³ã€å‘¼å«è·¯ç”±) | âœ… å®Œæˆ |
| â”œâ”€â”€ vdn/ | VDN è™šæ‹Ÿç›®å½•å·ç é…ç½® | âœ… å®Œæˆ |
| â”œâ”€â”€ vdnSchedule/ | VDN æ’ç­è°ƒåº¦ | âœ… å®Œæˆ |
| â””â”€â”€ playback/ | å½•éŸ³å›æ”¾ | âœ… å®Œæˆ |
| `/pages/AiChat/` | AI èŠå¤©æ¨¡å— | â­â­â­ |
| â”œâ”€â”€ agent/ | åå¸­ç«¯èŠå¤©ç•Œé¢ | ğŸ”¶ åŸºç¡€å®ç° |
| â”œâ”€â”€ user/ | ç”¨æˆ·ç«¯èŠå¤©ç•Œé¢ | ğŸ”¶ åŸºç¡€å®ç° |
| â””â”€â”€ components/ | æ¶ˆæ¯ç»„ä»¶ (Sender/Receiver) | âœ… å®Œæˆ |
| `/pages/flow/` | æµç¨‹è®¾è®¡å™¨ | â­â­â­â­ |
| â”œâ”€â”€ ivr/ | IVR æµç¨‹è®¾è®¡ (@antv/xflow) | âœ… å®Œæˆ |
| â”œâ”€â”€ flowmap/ | æµç¨‹å›¾ç®¡ç† | âœ… å®Œæˆ |
| â””â”€â”€ flowmanager/ | æµç¨‹ç‰ˆæœ¬ç®¡ç† | âœ… å®Œæˆ |
| `/pages/gptchat/` | GPT/LLM èŠå¤©æµ | â­â­â­ |
| â””â”€â”€ nodes/ | è‡ªå®šä¹‰èŠ‚ç‚¹ (LangChain é›†æˆ) | ğŸ”¶ å¼€å‘ä¸­ |
| `/pages/robot/` | æœºå™¨äººç®¡ç† | â­â­â­ |
| â”œâ”€â”€ knowledge/ | çŸ¥è¯†åº“ç®¡ç† | âœ… å®Œæˆ |
| â””â”€â”€ rbtsmanager/ | æœºå™¨äººå®ä¾‹ç®¡ç† | âœ… å®Œæˆ |
| `/pages/system/` | ç³»ç»Ÿç®¡ç† | â­â­â­â­â­ |
| â”œâ”€â”€ user/ | ç”¨æˆ·ç®¡ç† | âœ… å®Œæˆ |
| â”œâ”€â”€ role/ | è§’è‰²æƒé™ | âœ… å®Œæˆ |
| â”œâ”€â”€ menu/ | èœå•ç®¡ç† | âœ… å®Œæˆ |
| â”œâ”€â”€ dept/ | éƒ¨é—¨ç®¡ç† | âœ… å®Œæˆ |
| â”œâ”€â”€ dict/ | æ•°æ®å­—å…¸ | âœ… å®Œæˆ |
| â””â”€â”€ config/ | ç³»ç»Ÿé…ç½® | âœ… å®Œæˆ |
| `/pages/monitor/` | ç›‘æ§æ¨¡å— | â­â­â­â­ |
| â”œâ”€â”€ server/ | æœåŠ¡å™¨ç›‘æ§ | âœ… å®Œæˆ |
| â”œâ”€â”€ online/ | åœ¨çº¿ç”¨æˆ· | âœ… å®Œæˆ |
| â”œâ”€â”€ job/ | å®šæ—¶ä»»åŠ¡ | âœ… å®Œæˆ |
| â””â”€â”€ cache/ | ç¼“å­˜ç›‘æ§ | âœ… å®Œæˆ |
| `/pages/report/` | æŠ¥è¡¨æ¨¡å— | â­â­â­ |
| â”œâ”€â”€ agent/ | åå¸­æŠ¥è¡¨ | âœ… å®Œæˆ |
| â””â”€â”€ tcd/ | TCD ç»Ÿè®¡æŠ¥è¡¨ | âœ… å®Œæˆ |
| `/pages/dashboard/` | ä»ªè¡¨ç›˜ | â­â­â­ |

**API é›†æˆ**ï¼š
- `/src/api/` - Flowise AI é›†æˆ API
  - chatflows.js - èŠå¤©æµç®¡ç†
  - prediction.js - AI é¢„æµ‹
  - vectorstore.js - å‘é‡å­˜å‚¨
  - credentials.js - å‡­è¯ç®¡ç†
  - nodes.js - èŠ‚ç‚¹é…ç½®
- `/src/services/` - ä¸šåŠ¡ API
  - åŸºäº RESTful é£æ ¼
  - æ”¯æŒ OpenAPI è§„èŒƒ

**å®æ—¶é€šä¿¡**ï¼š
- Socket.io å®¢æˆ·ç«¯é›†æˆ (`/src/components/socket/`)
- é»˜è®¤è¿æ¥ç«¯å£: 30916
- å‘½åç©ºé—´: `/im/user`

#### 2. OnlineChat_Sample - åœ¨çº¿å®¢æœ Java åç«¯

**æŠ€æœ¯æ¶æ„**ï¼š
- Struts 2 + Spring + Hibernate
- åŸºäºæ³¨è§£çš„ Action é…ç½®
- æ‹¦æˆªå™¨é©±åŠ¨çš„æƒé™æ§åˆ¶

**åŒ…ç»“æ„**ï¼š
```
com.sxx.jcc/
â”œâ”€â”€ core/                # æ ¸å¿ƒæ¡†æ¶
â”‚   â”œâ”€â”€ cache/          # ç¼“å­˜å±‚ (SystemCache)
â”‚   â”œâ”€â”€ dao/            # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ filter/         # è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ intereptor/     # æ‹¦æˆªå™¨ (æƒé™)
â”‚   â”œâ”€â”€ model/          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ struts/         # Struts æ‰©å±•
â”‚   â””â”€â”€ utils/          # å·¥å…·ç±»
â”œâ”€â”€ webim/              # åœ¨çº¿å®¢æœæ¨¡å—
â”‚   â”œâ”€â”€ action/         # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ AgentController    # åå¸­æ§åˆ¶å™¨ (693è¡Œ)
â”‚   â”‚   â””â”€â”€ IMControllerAction # IM æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ pojo/           # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”œâ”€â”€ AgentStatus        # åå¸­çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ ChatMessage        # èŠå¤©æ¶ˆæ¯
â”‚   â”‚   â”œâ”€â”€ OnlineUser         # åœ¨çº¿ç”¨æˆ·
â”‚   â”‚   â””â”€â”€ QuickReply         # å¿«æ·å›å¤
â”‚   â”œâ”€â”€ service/        # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”œâ”€â”€ queue/          # æ’é˜Ÿæœºåˆ¶
â”‚   â”œâ”€â”€ rpc/            # RPC è°ƒç”¨
â”‚   â””â”€â”€ util/           # å·¥å…·ç±»
â”‚       â”œâ”€â”€ NettyIMClient      # Netty IM å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ NettyAgentClient   # Netty åå¸­å®¢æˆ·ç«¯
â”‚       â””â”€â”€ router/            # æ¶ˆæ¯è·¯ç”±å™¨
â””â”€â”€ common/             # å…¬å…±æ¨¡å—
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- åå¸­çŠ¶æ€ç®¡ç† (AgentStatus)
- ä¼šè¯åˆ†é…ä¸è·¯ç”± (ServiceQueue)
- æ¶ˆæ¯å†å²è®°å½• (ChatMessage)
- å¿«æ·å›å¤æ¨¡æ¿ (QuickReply)
- Netty é€šä¿¡å®¢æˆ·ç«¯

### é›†æˆç‚¹

| é›†æˆç±»å‹ | æŠ€æœ¯æ–¹æ¡ˆ | çŠ¶æ€ |
|---------|---------|------|
| AI/LLM | Flowise + LangChain | âœ… å·²é›†æˆ |
| å®æ—¶é€šä¿¡ | Socket.io + Netty | âœ… å·²é›†æˆ |
| æµç¨‹è®¾è®¡ | @antv/xflow | âœ… å·²é›†æˆ |
| å¯è§†åŒ– | ReactFlow + BizCharts | âœ… å·²é›†æˆ |
| ç¼“å­˜ | Memcached + Redis | âœ… å·²é›†æˆ |
| è®¤è¯ | åŸºäº Token + Session | âœ… å·²é›†æˆ |

### å¾…æ”¹è¿›é¡¹

| ä¼˜å…ˆçº§ | ç±»åˆ« | æè¿° |
|--------|------|------|
| ğŸ”´ é«˜ | å®‰å…¨ | å‰ç«¯ localStorage å­˜å‚¨å‡­è¯éœ€æ”¹è¿› |
| ğŸ”´ é«˜ | æ¶æ„ | Socket.io ç¡¬ç¼–ç ç«¯å£éœ€é…ç½®åŒ– |
| ğŸŸ¡ ä¸­ | ä»£ç è´¨é‡ | éƒ¨åˆ† any ç±»å‹éœ€è¦å…·ä½“åŒ– |
| ğŸŸ¡ ä¸­ | æµ‹è¯• | æµ‹è¯•è¦†ç›–ç‡éœ€æå‡ |
| ğŸŸ¢ ä½ | æ–‡æ¡£ | API æ–‡æ¡£éœ€å®Œå–„ |
| ğŸŸ¢ ä½ | å›½é™…åŒ– | éƒ¨åˆ†æ–‡æ¡ˆç¡¬ç¼–ç  |

### å¼€å‘ç«¯å£é…ç½®

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| å‰ç«¯å¼€å‘æœåŠ¡å™¨ | 8080 | UmiJS dev server |
| API æœåŠ¡ | 3000 | åç«¯ API (ç”Ÿäº§æ—¶ä½¿ç”¨åŒæº) |
| IM æœåŠ¡ | 30916 | Socket.io IM æœåŠ¡ |